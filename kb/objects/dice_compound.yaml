# Dice Compound - Demonstrates OR precondition with Cartesian product
#
# Scenario:
# - OR Precondition: (face == 6) OR (color == red)
#   - Success if face=6 (any color)
#   - Success if color=red (any face)
#   - Fail if face != 6 AND color != red (De Morgan)
# - Postcondition: checks SIZE (3rd different attribute!)
#     if size == large → jackpot prize
#     else (small, medium) → small prize
#
# When face=unknown AND color=unknown AND size=unknown:
# Creates branches:
#   Success branches (Cartesian product):
#   1. face=6, size=large → jackpot
#   2. face=6, size={small,medium} → small (else branch)
#   3. color=red, size=large → jackpot
#   4. color=red, size={small,medium} → small (else branch)
#   Fail branch:
#   5. face={1-5} AND color={green,yellow,black,white} → rejected
#
# Total: 4 success + 1 fail = 5 branches

type: dice_compound
parts:
  cube:
    attributes:
      face:
        space: dice_face
        default: "3"
        mutable: true
      color:
        space: dice_color
        default: green
        mutable: true
      size:
        space: dice_size
        default: medium
        mutable: true
  prize:
    attributes:
      level:
        space: prize_level
        default: none
        mutable: true
      result:
        space: result_state
        default: none
        mutable: true

behaviors:
  # Check win - OR precondition with different postcondition attribute
  check_compound_win:
    # OR Precondition: face==6 OR color==red
    preconditions:
      - type: or
        conditions:
          - type: attribute_check
            target: cube.face
            operator: equals
            value: "6"
          - type: attribute_check
            target: cube.color
            operator: equals
            value: red
    effects:
      # Set result to win
      - type: set_attribute
        target: prize.result
        value: win
      # Postcondition branches on SIZE (3rd attribute)
      # IF size == large -> jackpot prize
      - type: conditional
        condition:
          type: attribute_check
          target: cube.size
          operator: equals
          value: large
        then:
          - type: set_attribute
            target: prize.level
            value: jackpot
      # ELSE size in {small, medium} -> small prize
      - type: conditional
        condition:
          type: attribute_check
          target: cube.size
          operator: in
          value: ["small", "medium"]
        then:
          - type: set_attribute
            target: prize.level
            value: small

  # Reset the dice
  reset:
    effects:
      - type: set_attribute
        target: prize.result
        value: none
      - type: set_attribute
        target: prize.level
        value: none
