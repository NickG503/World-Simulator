# Flashlight object definition
# Simplified for tree-based simulation with flat if-elif-else structure

type: flashlight
parts:
  switch:
    attributes:
      position:
        space: binary_state
        default: 'off'
        mutable: true
  bulb:
    attributes:
      state:
        space: binary_state
        default: 'off'
        mutable: true
      brightness:
        space: brightness_level
        default: none
  battery:
    attributes:
      level:
        space: battery_level
        default: medium
        mutable: true
      type:
        space: battery_types
        mutable: false
        default: AA

constraints:
- type: dependency
  condition:
    type: attribute_check
    target: bulb.state
    operator: equals
    value: on
  requires:
    type: attribute_check
    target: battery.level
    operator: not_equals
    value: empty

behaviors:
  # Turn on: Flat if-elif-else structure based on battery.level
  turn_on:
    # Precondition: battery must not be empty
    preconditions:
      - type: attribute_check
        target: battery.level
        operator: not_equals
        value: empty
    effects:
      # Always set switch on
      - type: set_attribute
        target: switch.position
        value: "on"
      # Always turn bulb on (precondition ensures battery not empty)
      - type: set_attribute
        target: bulb.state
        value: "on"
      # Set trend down (battery drains)
      - type: set_trend
        target: battery.level
        direction: down
      # Flat if-elif-else for brightness based on battery.level
      # IF battery.level == full -> brightness = high
      - type: conditional
        condition:
          type: attribute_check
          target: battery.level
          operator: equals
          value: full
        then:
          - type: set_attribute
            target: bulb.brightness
            value: high
      # ELIF battery.level == high -> brightness = high
      - type: conditional
        condition:
          type: attribute_check
          target: battery.level
          operator: equals
          value: high
        then:
          - type: set_attribute
            target: bulb.brightness
            value: high
      # ELIF battery.level == medium -> brightness = medium
      - type: conditional
        condition:
          type: attribute_check
          target: battery.level
          operator: equals
          value: medium
        then:
          - type: set_attribute
            target: bulb.brightness
            value: medium
      # ELSE (low) -> brightness = low
      - type: conditional
        condition:
          type: attribute_check
          target: battery.level
          operator: equals
          value: low
        then:
          - type: set_attribute
            target: bulb.brightness
            value: low

  # Turn off: Simple, no conditions
  turn_off:
    effects:
      - type: set_attribute
        target: switch.position
        value: off
      - type: set_attribute
        target: bulb.state
        value: off
      - type: set_attribute
        target: bulb.brightness
        value: none
      - type: set_trend
        target: battery.level
        direction: none
