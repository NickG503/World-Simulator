# Pre-commit hooks configuration
# Uses only local hooks to avoid pip index issues with custom environments
#
# All hooks run using the project's uv-managed environment

repos:
  - repo: local
    hooks:
      # Ruff formatter
      - id: ruff-format
        name: ruff format
        entry: uv run ruff format --check
        language: system
        types: [python]
        pass_filenames: false
        args: [src/, tests/]

      # Ruff linter
      - id: ruff-lint
        name: ruff lint
        entry: uv run ruff check
        language: system
        types: [python]
        pass_filenames: false
        args: [src/, tests/]

      # Trailing whitespace
      - id: trailing-whitespace
        name: trailing whitespace
        entry: python -c "import sys; [exit(1) if l.rstrip() != l.rstrip('\n\r') else None for f in sys.argv[1:] for l in open(f)]"
        language: system
        types: [text]
        exclude: ^(.*\.md|.*\.txt)$

      # End of file fixer
      - id: end-of-file-fixer
        name: end of file fixer
        entry: python -c "import sys; [open(f,'a').write('\n') if open(f,'rb').read()[-1:] not in (b'\n',b'') else None for f in sys.argv[1:]]"
        language: system
        types: [text]
        exclude: ^(.*\.txt)$

      # Check YAML syntax
      - id: check-yaml
        name: check yaml
        entry: uv run python -c "import yaml, sys; [yaml.safe_load(open(f)) for f in sys.argv[1:]]"
        language: system
        types: [yaml]
        exclude: ^kb/

      # Check large files
      - id: check-large-files
        name: check large files
        entry: python -c "import sys,os; [exit(1) if os.path.getsize(f)>1000000 else None for f in sys.argv[1:]]"
        language: system
        types: [file]
